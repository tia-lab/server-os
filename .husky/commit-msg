#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the current commit count
COMMIT_COUNT=$(git rev-list --all --count 2>/dev/null || echo "0")
NEXT_NUMBER=$((COMMIT_COUNT + 1))

# Read the original commit message
ORIGINAL_MSG=$(cat "$1")

# Check if the message already has a number prefix
if ! echo "$ORIGINAL_MSG" | grep -qE '^\[[0-9]+\]'; then
    # Prepend the commit number
    echo "[$NEXT_NUMBER] $ORIGINAL_MSG" > "$1"
fi

# Run commitlint on the modified message
bunx commitlint --edit "$1"
